Apprentissage relationnel de motifs temporels
Marie-Odile Cordier, Rene´ Quiniou,
IRISA
Campus de Beaulieu
F-35042 RENNES Cedex
fMarie-Odile.Cordier,Rene.Quinioug@irisa.fr
http ://www.irisa.fr/dream/site/
Re´sume´. Nous pre´sentons deux expe´riences d’apprentissage relationnel de mo-
tifs temporels comportant des contraintes nume´riques - des chroniques - a` par-
tir de se´ries temporelles. La premie`re concerne l’apprentissage d’arythmies
cardiaques a` partir d’e´lectrocardiogrammes. La deuxie`me re´alise l’apprentis-
sage de re`gles pre´disant la de´gradation de la qualite´ de service dans un re´seau
de te´le´communications a` partir de donne´es d’exploitation. L’influence de la
me´thode de discre´tisation et de segmentation des donne´es sur la qualite´ des
re´sultats est discute´e.
1 Introduction
Une manie`re de re´aliser la supervision de syste`mes dynamiques, tels des proce´de´s indus-
triels ou des patients en unite´ de soins intensifs, consiste a` rechercher dans les valeurs fournies
par un ensemble de capteurs des configurations particulie`res, indicatrices de comportements
pathologiques. Les configurations les plus simples sont des changements notables sur la ten-
dance d’une variable indique´e par la valeur d’un capteur. Bien souvent, une simple variation sur
la tendance, baisse ou hausse plus ou moins brutale, n’est pas suffisamment discriminante et
plusieurs variations se produisant sur une ou plusieurs variables doivent eˆtre prises en compte
simultane´ment. De plus, la dure´e des variations ainsi que leur espacement sont souvent des
indications pre´cieuses permettant de mieux diagnostiquer les phe´nome`nes auxquels le syste`me
observe´ est soumis. Les chroniques (Dousson et al. 1993; Dousson et Vu Duong 1999) sont
particulie`rement bien adapte´es pour repre´senter de telles configurations complexes : une chro-
nique comprend un ensemble d’e´ve´nements soumis a` des contraintes temporelles portant sur
les de´lais minimum et maximum entre leurs occurrences respectives.
La de´tection en ligne de situations critiques consiste a` reconnaıˆtre de telles chroniques en
instanciant les e´ve´nements spe´cifie´s dans la chronique a` des e´ve´nements observe´s sur le flot
de donne´es en entre´e et a` ve´rifier, au fur et a` mesure de l’instanciation, que les contraintes
spe´cifie´es sont bien respecte´es. Parmi les avantages de cette me´thode on trouve le fait qu’il
n’est pas ne´cessaire que les e´ve´nements spe´cifie´s par une chronique soient contigus dans le
flot d’entre´e (des e´ve´nements parasites peuvent apparaıˆtre entre les e´ve´nements recherche´s).
- 211 - RNTI-E-5
Apprentissage relationnel de motifs temporels
Ceci la diffe´rencie de nombreuse me´thodes qui s’attachent a` rechercher des motifs temporels
plus ou moins exacts - au bruit ou a` la contraction et a` la dilatation pre`s - dans des se´ries
temporelles (Keogh et Ratanamahatana 2004).
La constitution d’une base de chroniques permettant de discriminer au mieux un ensemble
de pannes ou de pathologies est une taˆche ardue : elle ne´cessite de de´terminer les se´quences
d’e´ve´nements pertinentes et d’e´tablir les plages temporelles pouvant se´parer les occurrences
d’e´ve´nements. Nous nous inte´ressons a` l’utilisation de techniques d’apprentissage automa-
tique pour ce faire. Puisque le formalisme des chroniques de´crit des relations temporelles
entre e´ve´nements, leur apprentissage ne´cessite une technique s’appuyant sur un langage du
premier ordre, comme la programmation logique inductive (PLI) (Muggleton et De Raedt
1994). Nous pre´sentons succinctement son utilisation dans deux expe´riences : l’apprentissage
de re`gles de classification d’arythmies cardiaques a` partir d’e´lectrocardiogrammes et l’ap-
prentissage de re`gles pre´disant la de´gradation de la qualite´ de service (QoS) d’un re´seau de
te´le´communications a` partir de valeurs d’exploitation enregistre´es en certains nœuds ce re´seau.
2 Programmation logique inductive
La programmation logique inductive est une technique d’apprentissage supervise´ utilisant
le langage de programmation logique Prolog pour la repre´sentation des exemples et des re`gles
re´sultats. Un ope´rateur de raffinement permet de ge´ne´rer toutes les hypothe`ses possibles, des
plus ge´ne´rales aux plus spe´cifiques. Une hypothe`se est satisfaisante si, ajoute´e a` la connais-
sance a priori, elle couvre (elle permet de de´montrer) au moins un exemple positif et ne couvre
aucun exemple ne´gatif. L’apprentissage s’arreˆte de`s qu’un ensemble d’hypothe`ses satisfai-
santes permettant de couvrir tous les exemples positifs a e´te´ produit. Des heuristiques assurent
la se´lection des meilleures hypothe`ses a` chaque pas selon certains crite`res comme le taux de
couverture. La connaissance a priori est destine´e a` aider l’apprentissage en e´vitant de tout ap-
prendre. Enfin, les syste`mes de PLI, tel ICL (De Raedt et Van Laer 1995), permettent d’utiliser
un biais de langage de´claratif pour contraindre la forme et la complexite´ des re`gles.
3 Apprentissage d’arythmies cardiaques
L’e´lectrocardiogramme (ECG) fourni par douze capteurs pose´s sur la surface du corps d’un
patient refle`te l’activite´ e´lectrique du cœur au cours du temps. Il permet de diagnostiquer de
manie`re non invasive de nombreuses pathologies cardiaques par la simple analyse de la forme
des ondes pre´sentes dans le signal. La surveillance d’un patient, en unite´ de soins intensifs
par exemple, s’appuie sur l’analyse de l’ECG associe´ a` la mesure de la pression arte´rielle et
du rythme cardiaque et respiratoire. Nous nous sommes inte´resse´s a` la de´tection d’arythmies
cardiaques par la reconnaissance en ligne de chroniques. Elles sont apprises au pre´alable, par
programmation logique inductive, a` partir de fragments extraits d’ECG caracte´ristiques de ces
pathologies. Nous de´crivons ci-dessous les donne´es utilise´es et les re´sultats obtenus lors de
l’apprentissage.
- 212 -RNTI-E-5
Cordier et Quiniou
time wave shape
651 p normal
836 qrs normal
1357 qrs abnormal
2528 p normal
2686 qrs normal
3203 qrs abnormal
4428 p normal
4577 qrs normal
5086 qrs abnormal
6279 p normal
begin(model(bigeminy119_1)).
bigeminy.
w(p1,p,651,normal,noPreW).
w(r1,qrs,836,normal,p1).
w(r2,qrs,1357,abnormal,r1).
w(p2,p,2528,normal,r2).
w(r3,qrs,2686,normal,p2).
w(r4,qrs,3203,abnormal,r3).
w(p3,p,4428,normal,r4).
w(r5,qrs,4577,normal,p3).
w(r6,qrs,5086,abnormal,r5).
w(p4,p,6279,normal,r6).
end(model(bigeminy119_1)).
FIG. 1 – Le codage d’un fragment d’ECG : a` gauche une se´rie temporelle, a` droite un exemple
pour l’apprentissage.
3.1 Pre´paration des donne´es
L’ECG et les phe´nome`nes e´lectriques conduisant a` sa re´alisation sont bien connus. De nom-
breux algorithmes issus essentiellement du domaine du traitement de signal ont e´te´ propose´s,
non seulement pour la de´tection sur l’ECG d’ondes caracte´ristiques telles que l’onde P (ac-
tivation des oreillettes) ou l’onde complexe QRS (activation des ventricules) mais aussi pour
de´tecter des occurrences de´forme´es de ces ondes signant des pathologies bien re´pertorie´es.
Certaines pathologies restent hors d’atteinte de ces algorithmes car elles ne´cessitent une ana-
lyse sur plusieurs battements cardiaques ou la prise en compte d’e´le´ments plus fins tels que les
caracte´ristiques de l’onde P, pour la fibrillation auriculaire par exemple. Nous nous appuyons
sur les points forts des algorithmes de traitement de signal, la de´tection et la classification des
ondes principales de l’ECG (Carrault et al. 2003), pour constituer des se´ries temporelles a` forte
se´mantique en entre´e du syste`me de reconnaissance ainsi que du syste`me d’apprentissage.
L’abstraction temporelle des donne´es est re´alise´e par des transforme´es en ondelettes et des
re´seaux neuronaux. Sur une voie donne´e de l’ECG elle produit une se´quence d’e´ve´nements
date´s (onde P, QRS) ainsi qu’une qualification de leur forme en normal ou anormal (cf. fi-
gure 1). Pour l’apprentissage, un ensemble d’ECG ont e´te´ extraits de la base standard MIT-
BIH (Moody et Mark 1990) et code´s en respectant les annotations fournies (cf. figure 1).
Cinq classes ont e´te´ retenues : bigeminy (bige´minisme), lbbb (bloc de branche gauche),
mobitz2 (mobitz de type II), pvc (contraction ventriculaire pre´mature´e) et normal. La
classe normal ne correspond pas a` une pathologie mais elle permet de focaliser les re`gles
apprises sur des caracte´ristiques propres aux arythmies et proches des de´finitions utilise´es par
les cardiologues. La classe pvc augmente la difficulte´ de l’apprentissage : pvc est proche de
la classe normal car un tel ECG contient peu de battements anormaux et peu rapproche´s ;
pvc est e´galement proche de la classe bigeminy qui peut eˆtre conside´re´e comme un pvc
se produisant syste´matiquement tous les deux battements. 20 exemples repre´sentant des frag-
ments d’ECG de 10 secondes environ ont e´te´ fournis pour chaque classe. Le syste`me de PLI
utilise´ est ICL.
3.2 Re´sultats
Voici deux re`gles obtenues par apprentissage pour les classes lbbb et pvc :
class(lbbb) :-
- 213 - RNTI-E-5
Apprentissage relationnel de motifs temporels
mobitz2 bigeminy pvc lbbb normal Total VP+ VP-
mobitz2 427 0 0 1 0 428 1.00 1
bigeminy 0 155 4 0 10 169 0.92 1.00
pvc 0 0 269 0 0 269 1 0.97
lbbb 0 1 11 2012 1124 3148 0.64 1.00
normal 0 0 0 12 2819 2831 1.00 1
FN 0 11 220 5 0 236 0 1
Total 427 167 504 2030 2819 7081
Sensitivite´ 1 0.93 0.53 0.99 1
Spe´cificite´ 1.00 1.00 1 0.78 1.00
TAB. 1 – La matrice de confusion associe´e a` la reconnaissance de chronique. (FN faux
ne´gatifs, VP+, resp. VP-, valeur pre´dictive positive, resp. ne´gative).
qrs(R0, abnormal, _),
p_wav(P1, normal, R0), qrs(R1, abnormal, P1), pr1(P1,R0,normal).
class(pvc) :-
p_wav(P0, normal, _), qrs(R0, normal, P0),
p_wav(P1, normal, R0), qrs(R1, normal, P1),
qrs(R2, abnormal, R1), rr1(R1, R2, short).
Ces re`gles ont une traduction quasi-directe dans le formalisme des chroniques. Nous avons
e´value´ la qualite´ de l’ensemble de re`gles obtenues par une validation croise´e a` 10 tours. La
correction obtenue e´tait proche de 100 %. La performance des re`gles en reconnaissance a
e´galement e´te´ e´value´e sur des ECG e´tiquete´s d’une dure´e totale de 2 h provenant de la baseMIT
(cf. tableau 1). Les re´sultats sont bons hormis de nombreux pvc qui n’ont pu eˆtre reconnus
parce qu’associe´s a` des lbbb, une configuration non pre´vue en phase d’apprentissage. De
meˆme, la classe lbbb pre´sente un nombre important de faux positifs lie´s aux QRS anormaux
observe´s dans une situation mobitz2 et, en re´alite´, relatifs a` des blocs de branches droits
souvent associe´s a` cette pathologie.
4 Apprentissage de re`gles pre´disant la qualite´ de service
Les routeurs des re´seaux de te´le´communications enregistrent continuellement une masse
d’informations de´crivant le comportement ou l’e´tat du re´seau, comme le de´bit instantane´, l’e´tat
de diverses files d’attente, etc. Ces informations peuvent eˆtre exploite´es pour la gestion instan-
tane´e du re´seau, comme la modification des tables de routage, mais aussi pour diagnostiquer
des de´fauts qui pourraient avoir des conse´quences sur la qualite´ de service (QoS) constate´e
chez un client. Dans le projet Magda2, nous avons mene´ une expe´rience pour essayer pre´dire
la QoS a` partir d’indicateurs de´crivant le comportement de re´seau. Pour ce faire, les valeurs
de 6000 variables re´parties sur 6 routeurs ont e´te´ enregistre´es pendant environ 36 h a` raison
d’une valeur toutes les 20 s alors que divers sce´narios de pannes e´taient effectivement joue´s
sur le re´seau en fonctionnement (105 sce´narios pour cinq types de pannes) : coupure de lien et
saturation a` diffe´rents niveaux provoquant des congestions, etc. Dans le meˆme temps la QoS
e´tait estime´e par le taux de perte de paquets chez le client. Apre`s e´tude des corre´lations entre
variables, 140 se´ries temporelles ont finalement e´te´ retenues. Nous nous sommes inte´resse´s a`
- 214 -RNTI-E-5
Cordier et Quiniou
la de´couverte de re`gles spe´cifiant des variations de l’e´tat de plusieurs variables pre´ce´dant l’ob-
servation de la de´gradation de la QoS et les plages dans lesquelles varient les de´lais entre les
occurrences de ces diffe´rents e´ve´nements.
4.1 Pre´paration des donne´es
Une e´tape de re´duction de la complexite´ des se´ries temporelles est tout d’abord ne´cessaire.
Au contraire de l’expe´rience pre´sente´e plus haut, nous ne disposons pas d’une connaissance
suffisante pour recoder les se´ries temporelles en se´quences d’e´ve´nements significatifs date´s.
Nous avons donc retenu une repre´sentation line´aire par morceaux re´alise´e par une adaptation de
l’algorithme de Pratt et Fink (Pratt et Fink 2002). Elle est ensuite mise sous forme symbolique
par discre´tisation de la valeur des pentes des segments en cinq valeurs : forte monte´e, monte´e,
plateau, descente, forte descente. Les exemples ont e´te´ constitue´s par l’extraction de sous-
se´quences d’environ 7 mn aux environs des pe´riodes ou` les pannes ont e´te´ provoque´es.
La ge´ne´ration de re`gles est re´alise´e en deux e´tapes : tout d’abord ge´ne´ration de re`gles
d’association atemporelles discriminant les types de pannes, puis introduction de contraintes
temporelles en utilisant les informations issues des exemples couverts par ces re`gles. Nous
avons utilise´ le syste`me Aleph (Srinivasan 2001) pour cet apprentissage car il permet la prise
en compte de plus gros volume de donne´es.
4.2 Re´sultats
Voici une des re`gles obtenues lors de cet apprentissage :
degrad_qos(A,T) :-
frag(A,v4094,B,’step+’,T1), min(B,low),
frag(A,v4810,C,l,T2),
10<T-T1<30, 10<T-T2<30.
Elle signifie que si l’on observe une monte´e brutale a` l’instant T 1 sur la variable v40941
et un profil en ’L’ (plateau suivi d’une descente brutale suivie d’un plateau) sur la variable
v48102alors on observera une de´gradation de la QoS a` l’instant T situe´ entre 10 s et 30 s apre`s
T 1 et T 2. Nous avons utilise´ une validation croise´e de type leave-one-out pour l’e´valuation
des re´sultats. La correction des re`gles obtenues est excellente (environ 98 %, pour chacune
des classes). Du point de vue qualitatif les re`gles sont relativement ge´ne´rales, mais leur in-
terpre´tation est difficile car elles associent souvent des variables qu’il est difficile de relier.
La performance des re`gles obtenues en situation de reconnaissance quasi-re´elle n’a pas e´te´
e´value´e.
5 Conclusion - discussion
Nous avons pre´sente´ deux expe´riences d’apprentissage de chroniques a` partir de deux types
de se´ries temporelles abstrayant des signaux enregistre´s par des capteurs : dans la premie`re
les se´ries repre´sentent des se´quences d’e´ve´nements obtenus par application d’algorithmes de
1v4094 : Sophia-jnxCosIfqFc-Queued Pkts-network-control-38
2v4810 : Paris Saint Lambert 1-jnxCosIfqFc-HTRD Byte Rate-expedited-forwarding-52
- 215 - RNTI-E-5
Apprentissage relationnel de motifs temporels
traitement de signal ; dans la seconde les se´ries sont des se´quences de formes de base obtenues
par application d’un algorithme provenant du domaine de la fouille de donne´es, plus efficient
mais e´galement plus frustre.
Les e´le´ments apparaissant dans les se´ries du premier type ont une se´mantique tre`s affirme´e
et correspondent aux e´le´ments manipule´s par les spe´cialistes. Les re`gles obtenues sont de ce
fait facilement interpre´tables par un cardiologue. Elles ont e´te´ juge´es pertinentes apre`s expli-
cation du formalisme utilise´. Les e´le´ments utilise´s dans les repre´sentations de la deuxie`me
expe´rience sont plus ge´ne´raux et moins remarquables sur le plan se´mantique. Les re`gles ob-
tenues sont par conse´quent moins “parlantes” et un doute subsiste sur leur pertinence malgre´
leurs performances en apprentissage.
Re´fe´rences
Carrault G., Cordier M.-O., Quiniou R. et Wang F. (2003), Temporal abstraction and induc-
tive logic programming for arrhythmia recognition from ECG, Artificial Intelligence in
Medicine, Vol. 28, pp 231–263.
De Raedt L. et Van Laer W. (1995), Inductive constraint logic, Lecture Notes in Computer
Science, Vol. 997, pp 80–94.
Dousson C., Gaborit P. et Ghallab M. (1993), Situation recognition : representation and algo-
rithms, Proceedings of IJCAI-93, pp 166–172, Chambe´ry, France, Morgan Kaufman.
Dousson C. et Vu Duong T. (1999), Discovering chronicles with numerical time constraints
from alarm logs for monitoring dynamic systems, Proceedings of IJCAI 1999, pp 620–
626.
Keogh E. et Ratanamahatana C. A. (2004), Exact indexing of dynamic time warping, Know-
ledge and Information Systems : An International Journal (KAIS), 6(3).
Moody G. B. et Mark R. G. (1990), The MIT-BIH arrhythmia database on CD-ROM and
software for use with it, Proceedings of Computers in Cardiology Conference, volume 17,
pp 185–188, Chicago, IL, IEEE Computer Society Press.
Muggleton S. et De Raedt L. (1994), Inductive logic programming : Theory and methods, The
Journal of Logic Programming, Vol. 19 & 20, pp 629–680.
Pratt K. B. et Fink E. (2002), Search for patterns in compressed time series, International
Journal of Image and Graphics, 2(1), pp 89–106.
Srinivasan A. (2001), The Aleph Manual,
http ://web.comlab.ox.ac.uk/oucl/research/areas/machlearn/Aleph/.
Summary
We describe two experiments in relational learning temporal patterns with numericla
constraints - called chronicles - from temporal series. The first one is concerned with lear-
ning cardiac arrhythmias from electrocardiograms. The second one is about learning rules for
predicting quality of service degradation in a telecommunication network from data recorded
on routing devices. We discuss how the discretization method used for segmentation influences
the quality of the results.
- 216 -RNTI-E-5
